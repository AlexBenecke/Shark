---
title: "Figures"
author: "Alex Benecke"
date: "August 6, 2018"
output:
  html_document:
    df_print: paged
    fig_height: 6
    fig_width: 8
    toc: yes
    toc_depth: 4
    toc_float: yes
  word_document:
    reference_docx: word-styles_Figures.docx
    toc: yes
    toc_depth: '4'
editor_options:
  chunk_output_type: console
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = FALSE, message = FALSE, results = "asis")
```

```{r Load Packages, eval=TRUE, include=FALSE}
### Load Packages
library(FSA)
library(tidyverse)
library(dplyr)
library(magrittr)
library(scales)
library(mgcv)
library(sciplot)
library(knitr)
library(kableExtra)
library(pipeR)

#source("plot_centered_mean.R")

source("5_functions/dropbox_fn.R") # For interacting with dropbox
proj = "shark" # Specify project where data is stored 

source("5_functions/model_selection_fn.R")

source("5_functions/load_data.R")
```

```{r Load Data, eval=TRUE, echo=FALSE, include=FALSE}
eff3 <- read_csv_fn( "data/clean-data/CPUE3.csv", proj)

eff3$count <- 1

str(eff3)
headtail(eff3)

## Note pres must be numeric for table 1 >> I've been modifying the load_data with fact_vars if FALSE pres is not a factor variable (default is TRUE)

strat1_Adult <- load_data(data = eff3[eff3$maturity == "A",] %>% droplevels(), strata = 1, fact_vars = FALSE)
strat2_Adult <- load_data(data = eff3[eff3$maturity == "A",] %>% droplevels(), strata = 2, fact_vars = FALSE)

strat1_Juvenile <- load_data(data = eff3[eff3$maturity == "J",] %>% droplevels(), strata = 1, fact_vars = FALSE)
strat2_Juvenile <- load_data(data = eff3[eff3$maturity == "J",] %>% droplevels(), strata = 2, fact_vars = FALSE)
```

```{r Load Model Fits, eval=FALSE, include=FALSE}
### Strata1
  ## Female Adult
filenames_s1_FA <- list.files("output/output_GAM/strat1/Female/Adult", pattern="*.rda", full.names=TRUE)

for( i in 1:length( filenames_s1_FA ) ){ load( file = filenames_s1_FA[ i ] ) }

rm( filenames_s1_FA )

```


# List of Tables and Figures

## List of Tables

1. Table of number of positive catch stations for each species, year, sex, and where possible maturity.
i. Overall $\%$ of bottom long-line sets where a species of shark was present


2. Final list of Explanatory variables and results from QA/QC
i. list all variables give description
ii. was variable included or ommited (for species)
iii. range, mean, sd, and missing data
iv. Correlation between variables


3. Model Selection
i. Best model for each strata from each species and where possible level of Sex and Maturity
ii. Model structure
iii. Dev($\%$)
iv. AIC (or BIC)


## List of Figures

1. Site Map of northern Gulf of Mexico
i. give points where stations were sampled 
    - black dots with white outlines
ii. consider dividing gulf into regions (i.e., west, north, east)


2. Smooth Fits for each variable by strata and sex and maturity where possible
i. display in table of plots Explanatory variables x and strata maturity (and Sex) on Y


3. Heat Map showing CPUE by area in nGoM
i. think about how to structure this to compare within not between species



## Tables ##

### **Table 1**

summarize presence occurance (PA) and abundance (PRES)  of data used in analysis

i. give number of zeros and number of data pointa for both strata (PA and PRES) and level MATURE IMATURE (MALE and FEMALE) and Species
ii. Describe size cutoffs for Mature and Immature in captions
iii. either by year or by grouping years?
iv. Overall $\%$ of bottom long-line sets where a species of shark was present


### Table 1  (n Pos catch stations)

#### Table of Positive catch sites per year
```{r Prep data for table 1, eval=TRUE}
Species <- c("Blacknose", "Blacktip", "Sharpnose", "Sandbar", "Spinner", "Tiger", "Bull")


### for Blacknose, blacktip, and sharpnose with levels sex and maturity

strat1_Adult <- load_data(data = eff3[eff3$maturity == "A",] %>% droplevels(), strata = 1, fact_vars = FALSE)
strat2_Adult <- load_data(data = eff3[eff3$maturity == "A",] %>% droplevels(), strata = 2, fact_vars = FALSE)

strat1_Juvenile <- load_data(data = eff3[eff3$maturity == "J",] %>% droplevels(), strata = 1, fact_vars = FALSE)
strat2_Juvenile <- load_data(data = eff3[eff3$maturity == "J",] %>% droplevels(), strata = 2, fact_vars = FALSE)


### for sandbar, spinner, tiger, and bull, with just sex

strat1 <- load_data(data = eff3, strata = 1, fact_vars = FALSE)
strat2 <- load_data(data = eff3, strata = 2, fact_vars = FALSE)

```

First I need to loop through blacknose, blacktip, and sharpnose and create a df with the number of positibe catch for each year sex and maturiti.

```{r Make Data frame for number of sites with positive catch each year, results = 'hide', eval=TRUE, include=FALSE}

### Sex amd Maturity

for(i in 1:3 ){
  
 ## Female Adult
  aggregate(pres ~ year, data =strat1_Adult$Female[[i]], FUN = sum, drop = FALSE)[,"pres"] %>%
    t() %>%
    data.frame() %>%
    mutate( Species = Species[i], Sex = "Female", Maturity = "Adult") %>>%
    (~tmp_FA)
  
  colnames(tmp_FA) <- c(seq(2001,2017,1), "Species", "Sex", "Maturity")


 ## Female Juvenile
  aggregate(pres ~ year, data =strat1_Juvenile$Female[[i]], FUN = sum, drop = FALSE)[,"pres"] %>%
    t() %>%
    data.frame() %>%
    mutate( Species = Species[i], Sex = "Female", Maturity = "Juvenile") %>>%
    (~tmp_FJ)
  
  colnames(tmp_FJ) <- c(seq(2001,2017,1), "Species", "Sex", "Maturity")


 ## Male Adult
  aggregate(pres ~ year, data =strat1_Adult$Male[[i]], FUN = sum, drop = FALSE)[,"pres"] %>%
    t() %>%
    data.frame() %>%
    mutate( Species = Species[i], Sex = "Male", Maturity = "Adult")  %>>%
    (~tmp_MA)
  
  colnames(tmp_MA) <- c(seq(2001,2017,1), "Species", "Sex", "Maturity")


 ## Male Juvenile
  aggregate(pres ~ year, data =strat1_Juvenile$Male[[i]], FUN = sum, drop = FALSE)[,"pres"] %>%
    t() %>%
    data.frame() %>%
    mutate( Species = Species[i], Sex = "Male", Maturity = "Juvenile") %>>%
    (~tmp_MJ)
  
  colnames(tmp_MJ) <- c(seq(2001,2017,1), "Species", "Sex", "Maturity")

if(i == 1){
  
  rbind(tmp_FA, tmp_FJ, tmp_MA, tmp_MJ) %>>%
    (~tmp.df)  
  
} else{
  
  rbind(tmp.df, tmp_FA, tmp_FJ, tmp_MA, tmp_MJ) %>>%
    (~tmp.df)
  
}

}



pres.tbl <- tmp.df %>%
  dplyr::select(Species, Sex, Maturity, "2001":"2017")
pres.tbl



#pres.tbl$Total <- apply(pres.tbl[,4:20], 1, FUN = sum)
#pres.tbl



#pres.tbl

```

Now I need to loop through sandbar, Spinner, Tiger, and Bull and create a df with n pos catch for each year and sex.
```{r make df with n pos catch stations each year only Sex and only sb sp ti bu, results = 'hide', eval=TRUE, include=FALSE}

for(i in 4:7 ){
  
 ## Female 
  aggregate(pres ~ year, data =strat1$Female[[i]], FUN = sum, drop = FALSE)[,"pres"] %>%
    t() %>%
    data.frame() %>%
    mutate( Species = Species[i], Sex = "Female", Maturity = "") %>>%
    (~tmp_F)
  
  colnames(tmp_F) <- c(seq(2001,2017,1), "Species", "Sex", "Maturity")


 ## Male 
  aggregate(pres ~ year, data =strat1$Male[[i]], FUN = sum, drop = FALSE)[,"pres"] %>%
    t() %>%
    data.frame() %>%
    mutate( Species = Species[i], Sex = "Male", Maturity = "")  %>>%
    (~tmp_M)
  
  colnames(tmp_M) <- c(seq(2001,2017,1), "Species", "Sex", "Maturity")

if(i == 4){
  
  rbind(tmp_F, tmp_M) %>>%
    (~tmp.df2)  
  
} else{
  
  rbind(tmp.df2, tmp_F, tmp_M) %>>%
    (~tmp.df2)
  
}

}

pres.tbl2 <- tmp.df2 %>%
  select(Species, Sex, Maturity, "2001":"2017")
pres.tbl2

pres.tbl <- rbind(pres.tbl, pres.tbl2) 

pres.tbl

pres.tbl$Total <- apply(pres.tbl[,c(4:20)], 1, FUN = sum)
pres.tbl



pres.tbl

```

Now lets add a bottom row with the number of stations sampled each year

```{r prep total sites row of pos catch table, results = 'hide', eval=TRUE, include=FALSE}

### Get total number of sites sampled each year
aggregate(count ~ year, data =strat1_Adult$Female$sharpnose, FUN = sum, drop = FALSE)[,"count"] %>%
    t() %>%
    data.frame() %>%
    mutate( Species = "Total Stations", Sex = "", Maturity = "") %>>%
    (~all.sites.yr.sum)
  
  colnames(all.sites.yr.sum) <- c(seq(2001,2017,1), "Species", "Sex", "Maturity")

all.sites.yr.sum %<>%
  dplyr::select(Species, Sex, Maturity, "2001":"2017")

all.sites.yr.sum

all.sites.yr.sum$Total <- apply(all.sites.yr.sum[,c(4:20)], 1, FUN = sum)

all.sites.yr.sum


pres.tbl <- rbind(pres.tbl, all.sites.yr.sum)
pres.tbl

#10-15-2018#write_csv_fn(pres.tbl, file = "data/clean-data/table-data/pres_tbl.csv", proj = proj)

```

```{r Make table of positive catch sites per year, eval=TRUE, include=TRUE}
pres.tbl %>%
  kable() %>%
  kable_styling(full_width = F, 
                position = "center", 
                font_size = 10,
                bootstrap_options = "striped") %>%
  column_spec(1, bold = T, background = "White") %>%
  column_spec(2, background = "White") %>%
  column_spec(21, border_left = T) %>%
  collapse_rows(c(1:2), valign = "middle")# %>%
  #save_kable(file = "Table1.html", self_contained = T)
```


### Alt Table 1 b (Percent of Stations with Pos Catch)

```{r Prep Percent pos catch table, results='hide', eval=FALSE, include=FALSE}
all.sites.yr.sum <- pres.tbl[29,-c(22:23)]
row.names(all.sites.yr.sum) <- c(1)         

all.sites.yr.sum


tmp <- pres.tbl[c(1:28),-c(22:23)]
tmp


for(i in 1:nrow(tmp)){
  
  tmp[i,c(4:21)] <- round((tmp[i,c(4:21)]/all.sites.yr.sum[1,c(4:21)])*100, 1)
  
}


tmp

percent.pres.tbl <- tmp


percent.pres.tbl

#8-20-2018#write_csv_fn(percent.pres.tbl, file = "data/clean-data/table-data/percent_pres_tbl.csv", proj = proj)


```

```{r Make table of Percent positive of each species by year, eval=FALSE, include=TRUE}
percent.pres.tbl %>%
  kable() %>%
  kable_styling(full_width = F, 
                position = "center", 
                font_size = 10,
                bootstrap_options = "striped") %>%
  column_spec(1, bold = T, background = "White") %>%
  column_spec(2, background = "White") %>%
  column_spec(21, border_left = T) %>%
  collapse_rows(c(1:3), valign = "middle")
```

### **Table 2**

*List of variables and a description of each*

i. units
ii. type Biotic? environmental
iii. Temporal or spacial...

```{r, include=FALSE}

length(unique(strat1_Adult$Male$sharpnose$stationkey))
length(unique(strat1_Adult$Male$blacknose$stationkey))

```




```{r, results='hide', eval=TRUE, include=FALSE}
head(strat1_Adult$Male$sharpnose)

var.tbl <- strat1_Adult$Male$sharpnose %>%
  select( startdepth, tempbotm, turbbotm, oxybotm, salbotm, Dis.to.Shore ) %>%
  rename("Depth" = startdepth, "Temperature" = tempbotm, "Turbidity" = turbbotm, "Dissolved Oxygen" = oxybotm, 
         "Salinity" = salbotm, "Distance to Shore" = Dis.to.Shore)


head(var.tbl)
nrow(var.tbl)
length(var.tbl)



Min <- round(apply(var.tbl, 2, FUN =  min, na.rm = T),1)
Max <- round(apply(var.tbl, 2, FUN =  max, na.rm = T),1)
Mean <- round(apply(var.tbl, 2, FUN =  mean, na.rm = T),1)
SD <- round(apply(var.tbl, 2, FUN =  sd, na.rm = T),1)


( Missing <- numeric( length( var.tbl ) ))

for(i in 1:length( var.tbl ) ){
  
  Missing[i] <- round( (length( which( is.na( var.tbl[i] ) == TRUE) )/ nrow(var.tbl)) * 100, 1)
  
}
  

Missing
 

var.tbl.2 <- rbind(Min, Max, Mean, SD) %>% t() %>% data.frame()

var.tbl.2
```
```{r correlation of variables, eval=TRUE,}

(cor.tbl <- round( cor(var.tbl, use = "complete.obs"), 2) %>% data.frame())

str(cor.tbl)

var.tbl.2 <- var.tbl.2


var.tbl.2$Depth <- ""#numeric( nrow( var.tbl.2 ) )
var.tbl.2$Temperature <- ""#numeric( nrow( var.tbl.2 ) )
var.tbl.2$Turbidity <- ""#numeric( nrow( var.tbl.2 ) )
var.tbl.2$'Dissolved Oxygen' <- ""#numeric( nrow( var.tbl.2 ) )
var.tbl.2$Salinity <- ""#numeric( nrow( var.tbl.2 ) )
var.tbl.2$'Distance to Shore' <- ""#numeric( nrow( var.tbl.2 ) )
#var.tbl.2$Fluorometry <- ""#numeric( nrow( var.tbl.2 ) )


var.tbl.2[1,c(5:10)] <- cor.tbl$Depth
var.tbl.2[2,c(6:10)] <- cor.tbl$Temperature[c(2:6)]
var.tbl.2[3,c(7:10)] <- cor.tbl$Turbidity[c(3:6)]
var.tbl.2[4,c(8:10)] <- cor.tbl$Dissolved.Oxygen[c(4:6)]
var.tbl.2[5,c(9:10)] <- cor.tbl$Salinity[c(5:6)]
var.tbl.2[6,c(10:10)] <- cor.tbl$Distance.to.Shore[c(6)]
#var.tbl.2[7,c(12)] <- cor.tbl$Fluorometry[c(7)]


var.tbl.2

#10-10-2018#write_csv_fn(var.tbl.2, file = "data/clean-data/table-data/Table2.csv", row.names = TRUE, proj = proj)

```


```{r, eval=TRUE, include=TRUE}
var.tbl.2 %>%
  kable() %>%
  kable_styling(full_width = F, 
                position = "center", 
                font_size = 10,
                bootstrap_options = "striped") %>%
  add_header_above(c(" " = 5, "Correlation Table" = 6)) #%>%
  #save_kable(file = "Table2.html", self_contained = T)
```


### **Table 3** Model Selecton

Model Selection

i. Say top 2 or 3 models and global model for each species strata and level Mature immature (Male Female)
ii. identify model (stage strata lavel M I M F...)
iii. order best to worst + global model (A, B ... Global) 
iv. Model structure
v. Dev($\%$)
vi. AIC (or BIC)

**Note:** I run into memory problems if I try to load all the best models at once so I will build the table in parts by species and remove the models after comleting one part. I will then just have to combine the various table parts to one table with all species.


#### **Blacknose**
```{r Load Blacknose models for table 3, eval=TRUE, include=FALSE}
## Blacknose
filenames_bn <- list.files(c("output/output_GAM/best/blacknose/strat1",
                             "output/output_GAM/best/blacknose/strat2"), pattern="*.rda", full.names=TRUE)

for( i in 1:length( filenames_bn ) ){ 
  
  load( file = filenames_bn[ i ] ) 
  
  }

rm( filenames_bn, i )

mod_lst <- list(bn_s1_FA_best = bn_s1_FA_best, ## bn s1
                bn_s1_FJ_best = bn_s1_FJ_best,
                bn_s1_MA_best = bn_s1_MA_best,
                bn_s1_MJ_best = bn_s1_MJ_best
                ,
                bn_s2_FA_best = bn_s2_FA_best, ## bn s2
                bn_s2_FJ_best = bn_s2_FJ_best,
                bn_s2_MA_best = bn_s2_MA_best,
                bn_s2_MJ_best = bn_s2_MJ_best)

rm(bn_s1_FA_best, bn_s1_FJ_best, bn_s1_MA_best, bn_s1_MJ_best, 
   bn_s2_FA_best, bn_s2_FJ_best, bn_s2_MA_best, bn_s2_MJ_best)
```

```{r Set up Table 3 for Blacknose, eval=TRUE, include=FALSE}
model <- numeric( length(mod_lst) )
dev <- numeric( length(mod_lst) )
aic <- numeric( length(mod_lst) )


for(i in 1:length(mod_lst)){
  
  strsplit(as.character(mod_lst[[i]]$formula), "~")[[2]] %>>% (~response)
  
  model[i] <- paste(c(response, paste( c(rownames( summary( mod_lst[[i]] )$s.table ), mod_lst[[i]]$pterms[[3]]), collapse = " + ")), collapse = " ~ ")
  
  dev[i] <- round(summary(mod_lst[[i]])$dev.expl *100, 2)
  
  aic[i] <- round(mod_lst[[i]]$aic, 2)
}

model
dev
aic

(Species <- rep(c("Blacknose"), each = 8, length.out = length(mod_lst) ) )

(Strata <- rep(c("Presence", "Abundance"), each = 4))

(Sex <- rep(c("Female", "Male"), each = 2, length.out = length(mod_lst) ) )

(Maturity <- rep(c("Adult", "Juvenile"), length.out = length(mod_lst) ) )


(table3_bn <- cbind(Species, Strata, Sex, Maturity, model, dev, aic) %>%
    data.frame() %>%
    rename(Model = model, "Dev. Expl. (%)" = dev, AIC = aic))

rm( model, dev, aic, response, Species, 
    Strata, Sex, Maturity, mod_lst, i )
```



#### **Blacktip**
```{r Load Blacktip  models for table 3, eval=TRUE, include=FALSE}
## Blacktip
filenames_bt <- list.files(c("output/output_GAM/best/blacktip/strat1",
                             "output/output_GAM/best/blacktip/strat2"), pattern="*.rda", full.names=TRUE)

for( i in 1:length( filenames_bt ) ){ 
  
  load( file = filenames_bt[ i ] ) 
  
  }
rm( filenames_bt, i )

mod_lst <- list(bt_s1_FA_best = bt_s1_FA_best, ## bt s1
                bt_s1_FJ_best = bt_s1_FJ_best,
                bt_s1_MA_best = bt_s1_MA_best,
                bt_s1_MJ_best = bt_s1_MJ_best
                ,
                bt_s2_FA_best = bt_s2_FA_best, ## bt s2
                bt_s2_FJ_best = bt_s2_FJ_best,
                bt_s2_MA_best = bt_s2_MA_best,
                bt_s2_MJ_best = bt_s2_MJ_best)

rm(bt_s1_FA_best, bt_s1_FJ_best, bt_s1_MA_best, bt_s1_MJ_best, 
   bt_s2_FA_best, bt_s2_FJ_best, bt_s2_MA_best, bt_s2_MJ_best)
```



```{r Set up Table 3 for Blacktip, eval=TRUE, include=FALSE}
model <- numeric( length(mod_lst) )
dev <- numeric( length(mod_lst) )
aic <- numeric( length(mod_lst) )


for(i in 1:length(mod_lst)){
  
  strsplit(as.character(mod_lst[[i]]$formula), "~")[[2]] %>>% (~response)
  
  model[i] <- paste(c(response, paste( c(rownames( summary( mod_lst[[i]] )$s.table ), mod_lst[[i]]$pterms[[3]]), collapse = " + ")), collapse = " ~ ")
  
  dev[i] <- round(summary(mod_lst[[i]])$dev.expl *100, 2)
  
  aic[i] <- round(mod_lst[[i]]$aic, 2)
}

model
dev
aic

(Species <- rep(c("Blacktip"), each = 8, length.out = length(mod_lst) ) )

(Strata <- rep(c("Presence", "Abundance"), each = 4))

(Sex <- rep(c("Female", "Male"), each = 2, length.out = length(mod_lst) ) )

(Maturity <- rep(c("Adult", "Juvenile"), length.out = length(mod_lst) ) )


(table3_bt <- cbind(Species, Strata, Sex, Maturity, model, dev, aic) %>%
    data.frame() %>%
    rename(Model = model, "Dev. Expl. (%)" = dev, AIC = aic))

rm( model, dev, aic, response, Species, 
    Strata, Sex, Maturity, mod_lst, i )
```


#### **Sharpnose**
```{r Load Sharpnose models for table 3, eval=TRUE, include=FALSE}
## Sharpnose
filenames_sn <- list.files(c("output/output_GAM/best/sharpnose/strat1",
                             "output/output_GAM/best/sharpnose/strat2"), pattern="*.rda", full.names=TRUE)

for( i in 1:length( filenames_sn ) ){ 
  
  load( file = filenames_sn[ i ] ) 
  
  }

rm( filenames_sn, i )


mod_lst <- list(sn_s1_FA_best = sn_s1_FA_best, ## sn s1
                sn_s1_FJ_best = sn_s1_FJ_best,
                sn_s1_MA_best = sn_s1_MA_best,
                sn_s1_MJ_best = sn_s1_MJ_best
                ,
                sn_s2_FA_best = sn_s2_FA_best, ## sn s2
                sn_s2_FJ_best = sn_s2_FJ_best,
                sn_s2_MA_best = sn_s2_MA_best,
                sn_s2_MJ_best = sn_s2_MJ_best)

rm(sn_s1_FA_best, sn_s1_FJ_best, sn_s1_MA_best, sn_s1_MJ_best, 
   sn_s2_FA_best, sn_s2_FJ_best, sn_s2_MA_best, sn_s2_MJ_best)
```

```{r Set up Table 3 for Sharpnose, eval=TRUE, include=FALSE}
model <- numeric( length(mod_lst) )
dev <- numeric( length(mod_lst) )
aic <- numeric( length(mod_lst) )


for(i in 1:length(mod_lst)){
  
  strsplit(as.character(mod_lst[[i]]$formula), "~")[[2]] %>>% (~response)
  
  model[i] <- paste(c(response, paste( c(rownames( summary( mod_lst[[i]] )$s.table ), mod_lst[[i]]$pterms[[3]]), collapse = " + ")), collapse = " ~ ")
  
  dev[i] <- round(summary(mod_lst[[i]])$dev.expl *100, 2)
  
  aic[i] <- round(mod_lst[[i]]$aic, 2)
}

model
dev
aic

(Species <- rep(c("Sharpnose"), each = 8, length.out = length(mod_lst) ) )

(Strata <- rep(c("Presence", "Abundance"), each = 4))

(Sex <- rep(c("Female", "Male"), each = 2, length.out = length(mod_lst) ) )

(Maturity <- rep(c("Adult", "Juvenile"), length.out = length(mod_lst) ) )


(table3_sn <- cbind(Species, Strata, Sex, Maturity, model, dev, aic) %>%
    data.frame() %>%
    rename(Model = model, "Dev. Expl. (%)" = dev, AIC = aic))

rm( model, dev, aic, response, Species, 
    Strata, Sex, Maturity, mod_lst, i )
```



#### Combined table 3

```{r Set up Table 3, eval=TRUE, include=FALSE}
(table3 <- rbind(table3_bn, table3_bt, table3_sn))

#9-14-2018#write.csv(table3, file = "6_figures/tables/table_3.csv", row.names = FALSE)

rm(table3_bn, table3_bt, table3_sn)
```

```{r Table 3, eval=TRUE, include=TRUE}
library(kableExtra)

table3 %>%
  kable() %>%
  kable_styling(full_width = F, 
                position = "center",
                font_size = 10) %>%
  collapse_rows(columns = 1:3, valign = "middle")
```

```{r}
rm(table3)
```




## Figures ##


### **Figure 1** Site Map of northern Gulf of Mexico

Meg says to scrap this. 
  Use dots to represent stations and size (or transparensy) to represent number of stations
  make land dark grey and include state lines
  make water lighter grey no depth contours
  
#### New Figure 1
```{r, eval=FALSE, include=FALSE}
my_xlim <- c( -97, -81.5) #c(-97.5, -81)

my_ylim <- c( 24.5, 30.5 )

x_ticks <- seq( -97, -81.5 )
#-80.75, -81.25
y_ticks <- round( seq( 24.5, 30.5, length.out = 5 ), 1 )


cex_pts <- 0.8
col_pts <- rgb( 0.25, 0.25, 0.25, 0.25 ) ### only for Strata 1
cex_legend <- 1.25

lwd_axis <- 1.25
cex_axis <- 1.25
cex_mtxt <- 1.5

Lon_line <- 2
Lat_line <- 2.75
```
```{r, include=FALSE}
require(maptools)
require(sp)
library(rgdal)
library(lubridate)

gulf.shape <- "shape-file\\Shape\\stateshigh.shp"
gulf.shape <- maptools::readShapePoly(gulf.shape)
```

```{r tiff for new figure 1, include=FALSE}
tiff(filename = "6_figures\\figures\\Figure_1.tiff", width = 4000,  height = 2000, res = 300)
```

```{r New Figure 1, include=FALSE}
par(oma = c(2.75, 3.5, 0, 0), # two rows of text at the outer left and bottom margin
    mar = c(0.5, 0.5, 0, 0), # space for one row of text at ticks and to separate plots
    mgp = c(2, 0.75, 0))

plot(startlat ~ startlon,
     data = eff3,
     xlim = c(-97,-81.5),
     ylim = my_ylim,
     cex = cex_pts,
     pch = 21,
     bg = "Black",
     col = "white", 
     xlab = "", ylab = "",
     xaxt = "n", yaxt = "n",
     bty = "n",
     type = "n")

rect(par("usr")[1], par("usr")[3], par("usr")[2], par("usr")[4], col = "gray98", border = "white")

par(new = T)

plot(startlat ~ startlon,
     data = eff3,
     xlim = c(-97,-81.5),
     ylim = my_ylim,
     cex = cex_pts,
     pch = 21,
     bg = "Black",
     col = "white", 
     xlab = "", ylab = "",
     xaxt = "n", yaxt = "n",
     bty = "n")

sp::plot(gulf.shape, add = T,
         xlim = c( -97, -81.5),
         ylim = my_ylim,
         xlab = "", ylab = "",
         xaxt = "n", yaxt = "n",
         col = "gray",
         bty="n")

#polygon(c(study_area$x,study_area2$x),  c(study_area$y, study_area2$y), density = 5, angle = 135, border = rgb(1,1,1,0), lty = 3, lwd = 1.25)
#polygon(c(study_area$x,study_area2$x),  c(study_area$y, study_area2$y), density = 5, angle = 45, border = rgb(1,1,1,0), lty = 3, lwd = 1.25)


axis(2,
     at = y_ticks,
     las = 2,
     lwd = lwd_axis,
     cex.axis = cex_axis)

mtext("Latitude",
      side = 2,
      line = Lat_line,
      cex = cex_mtxt)

axis(1,
     at = x_ticks,
     lwd = lwd_axis,
     cex.axis = cex_axis)

mtext("Longitude",
      side = 1,
      line = Lon_line,
      cex = cex_mtxt)


dev.off()

```

![Figure 1 Site Map](figures\Figure_1.tiff)


#### Old Figure 1

i. give depth contours
ii. regions?

```{r Load shapefiles for Figure 1, eval = FALSE, include=FALSE}
require(maptools)
require(sp)
library(rgdal)
library(lubridate)


gulf.shape <- "shape-file\\Shape\\stateshigh.shp"
gulf.shape <- maptools::readShapePoly(gulf.shape)

gulf.bath1 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_L_0.shp"
gulf.bath2 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_K_200.shp"
gulf.bath3 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_J_1000.shp"
gulf.bath4 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_I_2000.shp"
gulf.bath5 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_H_3000.shp"
gulf.bath6 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_G_4000.shp"
gulf.bath7 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_F_5000.shp"
gulf.bath8 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_E_6000.shp"
gulf.bath9 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_D_7000.shp"
gulf.bath10 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_C_8000.shp"
gulf.bath11 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_B_9000.shp"
gulf.bath12 <- "shape-file\\bath\\ne_10m_bathymetry_all\\ne_10m_bathymetry_A_10000.shp"

country <- "shape-file\\countries\\ne_10m_admin_0_countries\\ne_10m_admin_0_countries.shp"
country <- maptools::readShapePoly(country)


gulf.bath <- list(gulf.bath1 = gulf.bath1,
                  gulf.bath2 = gulf.bath2,
                  gulf.bath3 = gulf.bath3,
                  gulf.bath4 = gulf.bath4,
                  gulf.bath5 = gulf.bath5,
                  gulf.bath6 = gulf.bath6,
                  gulf.bath7 = gulf.bath7,
                  gulf.bath8 = gulf.bath8,
                  gulf.bath9 = gulf.bath9,
                  gulf.bath10 = gulf.bath10,
                  gulf.bath11 = gulf.bath11,
                  gulf.bath12 = gulf.bath12)

for(i in 1:length(gulf.bath)){
  
  gulf.bath[[i]] <- maptools::readShapePoly(gulf.bath[[i]])
  
}
```

```{r Figure 1 Prep, eval = FALSE, include=FALSE}
#x1 <- c(-98.72202, 79.78476)
#y1 <- c( 19.54442, 31.43526)
y_ticks <- round(seq(24.5, 30.5, length.out = 5),1)
###### ^ Old ^ #####

my_xlim <- c(-97.5, -81)
my_ylim <- c(24.5,30.5)

x_ticks <- seq(-98, -81)
(y1_ticks <-  round(seq(20, 30.5, length.out = 5),1))
#(x1_ticks <- seq(-98.72202, -79.78476, length.out = 5))


lwd_axis1 <- 1
cex_axis1 <- 1
cex_mtxt1 <- 1.5

Lon_line1 <- 2
Lat_line1 <- 2.5

require(magrittr)
#seq(40, 84,6)
#(j = seq(40, 84, 4) %>% sort( decreasing = TRUE))

#(j = seq(22, 90, 6) %>% sort( decreasing = TRUE))

(j = seq(16, 93, 7) %>% sort( decreasing = TRUE))

#(j = seq(8, 96, 8) %>% sort( decreasing = TRUE))

(j = seq(0, 88, 8) %>% sort( decreasing = TRUE))

my_col <- numeric(length(j))


for(i in 1:length(j)){
  
  my_col[i] <- paste0("grey", j[i])
  
}

my_col

```

```{r study area line, eval = FALSE, include=FALSE}
study_area <- read_csv_fn("data/study_area.csv", proj)
study_area2 <- read_csv_fn("data/study_area2.csv", proj)
```

```{r tiff Figure 1, include=FALSE}
tiff(filename = "6_figures\\figures\\Figure_1.tiff", width = 4000,  height = 2000, res = 300)
```


```{r Plotting Figure 1, eval = FALSE, include=FALSE}
par(oma = c(2.75, 3.5, 0, 0), # two rows of text at the outer left and bottom margin
    mar = c(0.5, 0.5, 0, 0), # space for one row of text at ticks and to separate plots
    mgp = c(2, 0.75, 0))    # axis label at 2 rows distance, tick labels at 1 row

sp::plot(country, add = T,
         ylim = c(24.5,29.5),
         xlim = c(-98, -81),
         bty="n",
         col = "WHITE")#,
         #density = 10,
         #angle = 45)



#lines(x = study_area$x, y = study_area$y)
#lines(x = study_area2$x, y = study_area2$y)
#polygon(c(study_area$x,study_area2$x),  c(study_area$y, study_area2$y), density = 10, angle = 45)
#polygon(c(study_area$x,study_area2$x),  c(study_area$y, study_area2$y), density = 10, angle = 135)

    axis(2,
     at = y_ticks,
     las = 2,
     lwd = lwd_axis1,
     cex.axis = cex_axis1)
  
    mtext("Latitude",
      side = 2,
      line = Lat_line1,
      cex = cex_mtxt1)
    
    
    axis(1,
     at = x_ticks,
     lwd = lwd_axis1,
     cex.axis = cex_axis1)
  
    mtext("Longitude",
      side = 1,
      line = Lon_line1,
      cex = cex_mtxt1) 
    
    #dev.off()

for(i in 1:6){#length(gulf.bath)){
  
    sp::plot(gulf.bath[[i]], add =T,
           xlab = "", ylab = "",
           yaxt = "n", xaxt = "n",
         xlim = my_xlim, ylim = my_ylim,
         col = my_col[i])
  
  #Sys.sleep(0.2)
  
  }
polygon(c(study_area$x,study_area2$x),  c(study_area$y, study_area2$y), density = 4, angle = 135, border = rgb(1,1,1,0), lty = 3, lwd = 1.5)
polygon(c(study_area$x,study_area2$x),  c(study_area$y, study_area2$y), density = 4, angle = 45, border = rgb(1,1,1,0), lty = 3, lwd = 1.5)
    
dev.off()    
```









### **Figure 2**  Smooth Fits for each variable by strata and maturity (Maybe Sex)

i. display in table of plots Explanatory variables x and strata maturity (and Sex) on Y

Multiple species either multiple plots or overplotted with each other???

#### **Strat 1**

```{r Load Best Strat 1 Models, eval = FALSE, include = FALSE}
filenames_s1 <- list.files(c("output/output_GAM/best/blacknose/strat1",
                             "output/output_GAM/best/blacktip/strat1"
                             ,"output/output_GAM/best/sharpnose/strat1"
                             )
                           , pattern="*.rda", full.names=TRUE)

lapply(filenames_s1, load, .GlobalEnv)


rm( filenames_s1 )

### Create list of models



mod_lst_s1 <- list(bn_mod_s1 = list( # Blacknose
                                       bn_s1_FA_best = bn_s1_FA_best, ## bn s1
                                       bn_s1_FJ_best = bn_s1_FJ_best,
                                       bn_s1_MA_best = bn_s1_MA_best,
                                       bn_s1_MJ_best = bn_s1_MJ_best
                                       )
                ,
                bt_mod_s1 = list(    # Blacktip
                                       bt_s1_FA_best = bt_s1_FA_best, ## bt s1
                                       bt_s1_FJ_best = bt_s1_FJ_best,
                                       bt_s1_MA_best = bt_s1_MA_best,
                                       bt_s1_MJ_best = bt_s1_MJ_best
                                       )
                ,
                sn_mod_s1 = list(    # Sharpnose
                                       sn_s1_FA_best = sn_s1_FA_best, ## sn s1
                                       sn_s1_FJ_best = sn_s1_FJ_best,
                                       sn_s1_MA_best = sn_s1_MA_best,
                                       sn_s1_MJ_best = sn_s1_MJ_best
                                       )
                )

### Check list
length(mod_lst_s1);names(mod_lst_s1)
length(mod_lst_s1[[1]]);names(mod_lst_s1[[1]])
length(mod_lst_s1[[2]]);names(mod_lst_s1[[2]])
length(mod_lst_s1[[3]]);names(mod_lst_s1[[3]])
mod_lst_s1$bn_mod_s1$bn_s1_FA_best


rm(bn_s1_FA_best, bn_s1_FJ_best, bn_s1_MA_best, bn_s1_MJ_best
   ,
   bt_s1_FA_best, bt_s1_FJ_best, bt_s1_MA_best, bt_s1_MJ_best
   ,
   sn_s1_FA_best, sn_s1_FJ_best, sn_s1_MA_best, sn_s1_MJ_best 
   )
```


##### **Blacknose**

**Variable Order**

| Depth | Temperature | Turbidity | Dissolved Oxygen | Salinity | Distance to Shore | Year |
|:-----:|:-----------:|:---------:|:----------------:|:--------:|:-----------------:|:----:|
|  1    |    2        |    3      |       4          |    5     |         6         |   7  |

```{r strat1 Model structures Blacknose Fig2, include = FALSE, eval=FALSE}
## Blacknose
    ## Strat 1
 ## FA
plot(mod_lst_s1$bn_mod_s1$bn_s1_FA_best, pages = 1, scale = 0)
bn_row_1 <- c( 1, 0, 0, 4, 5, 0, 6)
            #  D, T, T, O, S, D, Y
  ## FJ
plot(mod_lst_s1$bn_mod_s1$bn_s1_FJ_best, pages = 1, scale = 0)
bn_row_2 <- c(7, 0, 8, 9, 10, 0, 11)
            #  D, T, T, O, S, D, Y
  ## MA
plot(mod_lst_s1$bn_mod_s1$bn_s1_MA_best, pages = 1, scale = 0)
bn_row_3 <- c(12, 0, 13, 14, 15, 16, 17)
            #  D,  T,  T, O, S, D, Y
  ## MJ
plot(mod_lst_s1$bn_mod_s1$bn_s1_MJ_best, pages = 1, scale = 0)
bn_row_4 <- c(0, 18, 19, 20, 0, 21, 22)
            #  D,  T,  T, O, S, D, Y

(bn_mat_s1 <- matrix(c(bn_row_1, bn_row_2, bn_row_3, bn_row_4),
                  nrow = 4, ncol = 7, byrow = TRUE) )
bn.lay.s1 <- layout( bn_mat_s1 )
layout.show( bn.lay.s1 )
```


##### **Blacktip**

**Variable Order**

| Depth | Temperature | Turbidity | Dissolved Oxygen | Salinity | Distance to Shore | Year |
|:-----:|:-----------:|:---------:|:----------------:|:--------:|:-----------------:|:----:|
|  1    |    2        |    3      |       4          |    5     |         6         |   7  |

```{r strat1 Blacktip Model structures  Fig2, include = FALSE, eval=FALSE}
## Blacktip
    ## Strat 1
 ## FA
plot(mod_lst_s1$bt_mod_s1$bt_s1_FA_best, pages = 1)
bt_row_1 <-  c(0, 1, 0, 2, 0, 3, 4)
            #  D, T, T, O, S, D, Y
  ## FJ
plot(mod_lst_s1$bt_mod_s1$bt_s1_FJ_best, pages = 1)
bt_row_2 <- c(5, 0, 6, 7, 0, 0, 8)
            #  D, T, T, O, S, D, Y
  ## MA
plot(mod_lst_s1$bt_mod_s1$bt_s1_MA_best, pages = 1)
bt_row_3 <- c(9, 0, 10, 11, 0, 0, 12)
            #  D, T, T, O, S, D, Y
  ## MJ
plot(mod_lst_s1$bt_mod_s1$bt_s1_MJ_best, pages = 1)
bt_row_4 <- c(0, 13, 14, 15, 16, 0, 17)
            #  D, T, T, O, S, D, Y


(bt_mat_s1 <- matrix(c(bt_row_1, bt_row_2, bt_row_3, bt_row_4),
                  nrow = 4, ncol = 7, byrow = TRUE) )
bt.lay.s1 <- layout( bt_mat_s1 )
layout.show( bt.lay.s1 )
```



##### **Sharpnose**

**Variable Order**

| Depth | Temperature | Turbidity | Dissolved Oxygen | Salinity | Distance to Shore | Year |
|:-----:|:-----------:|:---------:|:----------------:|:--------:|:-----------------:|:----:|
|  1    |    2        |    3      |       4          |    5     |         6         |   7  |

```{r strat1 Sharpnose Model structures Fig2, include = FALSE, eval=FALSE}
## Sharpnose
    ## Strat 1
 ## FA
plot(mod_lst_s1$sn_mod_s1$sn_s1_FA_best, pages = 1)
sn_row_1 <- c(1, 0, 2, 3, 0, 0, 4)
            #  D, T, T, O, S, D, Y
  ## FJ
plot(mod_lst_s1$sn_mod_s1$sn_s1_FJ_best, pages = 1)
sn_row_2 <- c(0, 5, 6, 7, 0, 8, 9)
            #  D, T, T, O, S, D, Y
  ## MA
plot(mod_lst_s1$sn_mod_s1$sn_s1_MA_best, pages = 1)
sn_row_3 <- c(10, 0, 11, 12, 13, 0, 14)
            #  D,  T,  T, O, S, D, Y
  ## MJ
plot(mod_lst_s1$sn_mod_s1$sn_s1_MJ_best, pages = 1)
sn_row_4 <- c(0, 15, 16, 0, 0, 0, 17)
            #  D, T, T, O, S, D, Y

(sn_mat_s1 <- matrix(c(sn_row_1, sn_row_2, sn_row_3, sn_row_4),
                  nrow = 4, ncol = 7, byrow = TRUE) )
sn.lay.s1 <- layout( sn_mat_s1 )
layout.show( sn.lay.s1 )
```

I will have to make a unique layout for each species. By looking at the formula of the best fit model I've determined which terms are included and will use this information to create a matrix for *layout()*.

##### Figure 2 loop **Strat 1**

```{r Layouts for Figure 2 strat 1, include = FALSE, eval=FALSE}
  # Strat 1
lay_mat_s1 <- list(bn_mat_s1,
                   bt_mat_s1,
                   sn_mat_s1
                   )
```

```{r figure 2 strat 1 tiff file paths, include = FALSE, eval=FALSE}
# Strata 1
file_name_s1 <- numeric( length(lay_mat_s1) )

letr_s1 <- letters[c(seq(1, 14, by = 2))]


for(i in 1:length(file_name_s1) ){
  
  file_name_s1[i] <- paste0("6_figures\\figures\\Figure_2_(",letr_s1[i], ").tiff")
}

file_name_s1
```

```{r  Figure 2 prep strat 1, include=FALSE, eval=FALSE}

cex_txt <- 1
cex_lab <- 1.5
cex_axis <- 1.25
my_lwd <- 1.75
y_line <- 1.25
x_line <- -0.75

letter_line <- -0.75
letter_at <- 0

sleep_time <- 0.01
```
```{r make unique y-lims, include=FALSE, eval=FALSE}
my_ylim <- list(bn_ylim = list(c(-50,50), ## lat-lon
                               c(-50,50), ## depth
                               c(-50,50), ## temp
                               c(-50,50), ## turb
                               c(-50,50), ## oxy
                               c(-50,50), ## sal
                               c(-50,50), ## dis
                               c(-50,50)  ## Year
                               )
                ,
                bt_ylim = list(c(-50,50), ## lat-lon
                               c(-50,50), ## depth
                               c(-50,50), ## temp
                               c(-50,50), ## turb
                               c(-50,50), ## oxy
                               c(-50,50), ## sal
                               c(-50,50), ## dis
                               c(-50,50)  ## Year
                               )
                ,
                sn_ylim = list(c(-50,50), ## lat-lon
                               c(-50,50), ## depth
                               c(-50,50), ## temp
                               c(-50,50), ## turb
                               c(-50,50), ## oxy
                               c(-50,50), ## sal
                               c(-50,50), ## dis
                               c(-50,50)  ## Year
                               )
                ) 

```


```{r Figure 2 Strata 1 plots Loop, include=FALSE, eval = FALSE}
# Strata 1

for(i in 1:length(mod_lst_s1) ){ ## loop through species level of mod_lst_s1
  
  tiff(filename =  file_name_s1[i], height = 2000, width = 2500, res = 300)
  
  par(oma = c(1.5, 3.25, 1, 1), # two rows of text at the outer left and bottom margin
    mar = c(1, 1, 1, 1), # space for one row of text at ticks and to separate plots
    mgp = c(1.75, 0.75, 0))
  
  layout( lay_mat_s1[[i]] )
  
    
    for(j in 1:length( mod_lst_s1[[i]] ) ){ ### loop through Sex, and Maturity level of mod_lst_s1 
      
      for(k in 2:8){ ## Loop through specific variables in each level of sex and maturity for specific species
    
    plot(mod_lst_s1[[i]][[j]], select = k,
         xlab = "", ylab = "",
         main = "",
         lwd= my_lwd, 
         cex.axis = cex_axis, 
         cex.lab = cex_lab, 
         bty = "n")
    
    abline( h = 0, col = "blue", lty = 3)  
    
    Sys.sleep(sleep_time)
    
    }
      
    }
    Sys.sleep(sleep_time)
    
    
  
  
  ### Y labels
    mtext("Female Adult ",
        side = 2, 
        at = 0.875,
        line = y_line,
        cex = cex_txt, 
        outer = TRUE)
  
    mtext("Female Juvenile",
        side = 2,
        at = 0.625,
        line = y_line,
        cex = cex_txt,
        outer = TRUE)
    
      mtext("Male Adult",
        side = 2, 
        at = 0.375,
        line = y_line,
        cex = cex_txt,
        outer = TRUE)
      
        mtext("Male Juvenile",
        side = 2, 
        at = 0.125,
        line = y_line,
        cex = cex_txt,
        outer = TRUE)
  ### X Labels
        mtext("Depth",
        side = 3, 
        at = 1/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
        mtext("Temp",
        side = 3, 
        at = 3/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
        mtext("Turb",
        side = 3, 
        at = 5/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
        mtext("Oxy",
        side = 3, 
        at = 1/2,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
        mtext("Sal",
        side = 3, 
        at = 9/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
        mtext("Distance",
        side = 3, 
        at = 11/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
       
         mtext("Year",
        side = 3, 
        at = 13/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
         ### Figure letter
        mtext(paste0("(", letr_s1[i], ")"),
        side = 3, 
        at = letter_at,
        line = letter_line,
        cex = cex_txt,
        outer = TRUE) 
         
        
        Sys.sleep(sleep_time)
        
        dev.off()
        
}

```




#### **Strat 2** Figure 2

```{r Load Best Strat 2 Models, eval = FALSE, include = FALSE}
filenames_s2 <- list.files(c("output/output_GAM/best/blacknose/strat2",
                             "output/output_GAM/best/blacktip/strat2",
                             "output/output_GAM/best/sharpnose/strat2"), pattern="*.rda", full.names=TRUE)

lapply(filenames_s2, load, .GlobalEnv)

rm( filenames_s2 )


### Create list of models

mod_lst_s2 <- list(bn_mod_s2 = list( # Blacknose
                                       bn_s2_FA_best = bn_s2_FA_best, ## bn s2
                                       bn_s2_FJ_best = bn_s2_FJ_best,
                                       bn_s2_MA_best = bn_s2_MA_best,
                                       bn_s2_MJ_best = bn_s2_MJ_best
                                       )
                ,
                bt_mod_s2 = list(    # Blacktip
                                       bt_s2_FA_best = bt_s2_FA_best, ## bt s2
                                       bt_s2_FJ_best = bt_s2_FJ_best,
                                       bt_s2_MA_best = bt_s2_MA_best,
                                       bt_s2_MJ_best = bt_s2_MJ_best
                                       )
                ,
                sn_mod_s2 = list(    # Sharpnose
                                       sn_s2_FA_best = sn_s2_FA_best, ## sn s2
                                       sn_s2_FJ_best = sn_s2_FJ_best,
                                       sn_s2_MA_best = sn_s2_MA_best,
                                       sn_s2_MJ_best = sn_s2_MJ_best
                                       )
                )
length(mod_lst_s2);names(mod_lst_s2)
length(mod_lst_s2[[1]]);names(mod_lst_s2[[1]])
length(mod_lst_s2[[2]]);names(mod_lst_s2[[2]])
length(mod_lst_s2[[3]]);names(mod_lst_s2[[3]])


rm(bn_s2_FA_best, bn_s2_FJ_best, bn_s2_MA_best, bn_s2_MJ_best
   ,
   bt_s2_FA_best, bt_s2_FJ_best, bt_s2_MA_best, bt_s2_MJ_best
   ,
   sn_s2_FA_best, sn_s2_FJ_best, sn_s2_MA_best, sn_s2_MJ_best)
```


##### **Blacknose**

**Variable Order**

| Depth | Temperature | Turbidity | Dissolved Oxygen | Salinity | Distance to Shore | Year |
|:-----:|:-----------:|:---------:|:----------------:|:--------:|:-----------------:|:----:|
|  1    |    2        |    3      |       4          |    5     |         6         |   7  |

```{r Model structures Blacknose Fig2, include = FALSE, eval=FALSE}
## Blacknose
    ## Strat 2
 ## FA
plot(mod_lst_s2$bn_mod_s2$bn_s2_FA_best, pages = 1)
bn_row_5 <- c(0, 0, 1, 0, 0, 0, 2)
            #  D, T, T, O, S, D, Y
  ## FJ
plot(mod_lst_s2$bn_mod_s2$bn_s2_FJ_best, pages = 1)
bn_row_6 <- c(0, 3, 4, 5, 6, 7, 8)
            #  D, T, T, O, S, D, Y
  ## MA
plot(mod_lst_s2$bn_mod_s2$bn_s2_MA_best, pages = 1)
bn_row_7 <- c(0, 9, 10, 11, 12, 0, 13)
            #  D, T, T, O, S, D, Y
  ## MJ
plot(mod_lst_s2$bn_mod_s2$bn_s2_MJ_best, pages = 1)
bn_row_8 <- c(14, 0, 15, 16, 17, 0, 18)
            #  D, T, T, O, S, D, Y

(bn_mat_s2 <- matrix(c(bn_row_5, bn_row_6, bn_row_7, bn_row_8),
                  nrow = 4, ncol = 7, byrow = TRUE) )

bn.lay.s2 <- layout( bn_mat_s2 )
layout.show( bn.lay.s2 )
```


##### **Blacktip**

**Variable Order**

| Depth | Temperature | Turbidity | Dissolved Oxygen | Salinity | Distance to Shore | Year |
|:-----:|:-----------:|:---------:|:----------------:|:--------:|:-----------------:|:----:|
|  1    |    2        |    3      |       4          |    5     |         6         |   7  |

```{r Blacktip Model structures  Fig2, include = FALSE, eval=FALSE}
## Blacktip
    ## Strat 2
 ## FA
plot(mod_lst_s2$bt_mod_s2$bt_s2_FA_best, pages = 1)
bt_row_5 <- c(0, 0, 1, 0, 2, 0, 3)
            #  D, T, T, O, S, D, Y
  ## FJ
plot(mod_lst_s2$bt_mod_s2$bt_s2_FJ_best, pages = 1)
bt_row_6 <- c(4, 0, 5, 0, 6, 0, 7)
            #  D, T, T, O, S, D, Y
  ## MA
plot(mod_lst_s2$bt_mod_s2$bt_s2_MA_best, pages = 1)
bt_row_7 <- c(8, 0, 9, 0, 0, 0, 10)
            #  D, T, T, O, S, D, Y
  ## MJ
plot(mod_lst_s2$bt_mod_s2$bt_s2_MJ_best, pages = 1)
bt_row_8 <- c(11, 0, 0, 12, 13, 0, 14)
            #  D, T, T, O, S, D, Y

(bt_mat_s2 <- matrix(c(bt_row_5, bt_row_6, bt_row_7, bt_row_8),
                  nrow = 4, ncol = 7, byrow = TRUE) )

bt.lay.s2 <- layout( bt_mat_s2 )
layout.show( bt.lay.s2 )
```



##### **Sharpnose**

**Variable Order**

| Depth | Temperature | Turbidity | Dissolved Oxygen | Salinity | Distance to Shore | Year |
|:-----:|:-----------:|:---------:|:----------------:|:--------:|:-----------------:|:----:|
|  1    |    2        |    3      |       4          |    5     |         6         |   7  |

```{r Sharpnose Model structures Fig2, include = FALSE, eval=FALSE}
## Sharpnose
    ## Strat 2
 ## FA
plot(mod_lst_s2$sn_mod_s2$sn_s2_FA_best, pages = 1)
sn_row_5 <- c(0, 1, 2, 0, 0, 0, 3)
            #  D, T, T, O, S, D, Y
  ## FJ
plot(mod_lst_s2$sn_mod_s2$sn_s2_FJ_best, pages = 1)
sn_row_6 <- c(0, 4, 5, 0, 0, 0, 6)
            #  D, T, T, O, S, D, Y
  ## MA
plot(mod_lst_s2$sn_mod_s2$sn_s2_MA_best, pages = 1)
sn_row_7 <- c(7, 0, 0, 8, 9, 10, 11)
            #  D, T, T, O, S, D, Y
  ## MJ
plot(mod_lst_s2$sn_mod_s2$sn_s2_MJ_best, pages = 1)
sn_row_8 <- c(0, 12, 0, 13, 0, 0, 14)
            #  D, T, T, O, S, D, Y

(sn_mat_s2 <- matrix(c(sn_row_5, sn_row_6, sn_row_7, sn_row_8),
                  nrow = 4, ncol = 7, byrow = TRUE) )

sn.lay.s2 <- layout( sn_mat_s2 )
layout.show( sn.lay.s2 )
```

##### Figure 2 loop **Strat 2**

```{r Layouts for Figure 2 , include = FALSE, eval=FALSE}
# strat 2

lay_mat_s2 <- list(bn_mat_s2,
                   bt_mat_s2,
                   sn_mat_s2
                   )
```

```{r figure 2 tiff file paths, include = FALSE, eval=FALSE}
# Strata 2

file_name_s2 <- numeric( length(lay_mat_s2) )

letr_s2 <- letters[c(seq(2, 14, by = 2))]

for(i in 1:length(file_name_s2) ){
  
  file_name_s2[i] <- paste0("6_figures\\figures\\Figure_2_(",letr_s2[i], ").tiff")
}

file_name_s2
```

```{r  Figure 2 prep, eval=FALSE, include=FALSE}

cex_txt <- 1
cex_lab <- 1.5
cex_axis <- 1.25
my_lwd <- 1.75
y_line <- 1.25
x_line <- -0.75

letter_line <- -0.75
letter_at <- 0

sleep_time <- 0.01

```


```{r  Figure 2 Strata 2 plots Loop, include=FALSE, eval = FALSE}
# Strata 2
for(i in 1:length(mod_lst_s2) ){ ### loop through species level in mod_lst_s2
  
  tiff(filename =  file_name_s2[i], height = 2000, width = 2500, res = 300)
  
  par(oma = c(1.5, 3.25, 1, 1), # two rows of text at the outer left and bottom margin
    mar = c(1, 1, 1, 1), # space for one row of text at ticks and to separate plots
    mgp = c(1.75, 0.75, 0))
  
  layout( lay_mat_s2[[i]] )
  
for(j in 1:length(mod_lst_s2[[i]])){ ## Loop through Sex and maturity levels for a species
  
  for(k in 2:8){ ## loop through explanatory variables in one level of sex and maturity for a species
    
    plot(mod_lst_s2[[i]][[j]], select = k,
         xlab = "", ylab = "",
         main = "",
         lwd= my_lwd, 
         cex.axis = cex_axis, 
         cex.lab = cex_lab, 
         bty = "n")
    
    abline( h = 0, col = "blue", lty = 3)    
    
  }   
  
} 
  
  
  ### Y labels
    mtext("Female Adult ",
        side = 2, 
        at = 0.875,
        line = y_line,
        cex = cex_txt, 
        outer = TRUE)
  
    mtext("Female Juvenile",
        side = 2,
        at = 0.625,
        line = y_line,
        cex = cex_txt,
        outer = TRUE)
    
      mtext("Male Adult",
        side = 2, 
        at = 0.375,
        line = y_line,
        cex = cex_txt,
        outer = TRUE)
      
        mtext("Male Juvenile",
        side = 2, 
        at = 0.125,
        line = y_line,
        cex = cex_txt,
        outer = TRUE)
  ### X Labels
        mtext("Depth",
        side = 3, 
        at = 1/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
        mtext("Temp",
        side = 3, 
        at = 3/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
        mtext("Turb",
        side = 3, 
        at = 5/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
        mtext("Oxy",
        side = 3, 
        at = 1/2,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
        mtext("Sal",
        side = 3, 
        at = 9/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
        mtext("Distance",
        side = 3, 
        at = 11/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
       
         mtext("Year",
        side = 3, 
        at = 13/14,
        line = x_line,
        cex = cex_txt,
        outer = TRUE)
        
         ### Figure letter
        mtext(paste0("(", letr_s2[i], ")"),
        side = 3, 
        at = letter_at,
        line = letter_line,
        cex = cex_txt,
        outer = TRUE) 
         
        
        Sys.sleep(sleep_time)
        
        dev.off()
        
}
```

![**Figure 2 a** Blacknose Strat 1](figures\Figure_2_(a).tiff)

![**Figure 2 b** Blacknose  Strat 2](figures\Figure_2_(b).tiff)


![**Figure 2 c** Blacktip Strat 1](figures\Figure_2_(c).tiff)

![**Figure 2 d** Blacktip  Strat 2](figures\Figure_2_(d).tiff)


![**Figure 2 e** Sharpnose Strat 1](figures\Figure_2_(e).tiff)

![**Figure 2 f** Sharpnose  Strat 2](figures\Figure_2_(f).tiff)




### **Figure 3** Heat Map showing CPUE by area in nGoM

i. maybe show map with presence and abscense of each species aswell 
ii. either species 4 rows by 2 columns Or consider year to year comparison of each species

```{r Load Data for Figure 3, include=FALSE, eval=FALSE}
eff3 <- read_csv_fn( "data/clean-data/CPUE3.csv", proj)

eff3$count <- 1

str(eff3)
headtail(eff3)

## Note pres must be numeric for table 1 >> I've been modifying the load_data with fact_vars if FALSE pres is not a factor variable (default is TRUE)

strat1_Adult <- load_data(data = eff3[eff3$maturity == "A",] %>% droplevels(), strata = 1, fact_vars = FALSE)
strat2_Adult <- load_data(data = eff3[eff3$maturity == "A",] %>% droplevels(), strata = 2, fact_vars = FALSE)

strat1_Juvenile <- load_data(data = eff3[eff3$maturity == "J",] %>% droplevels(), strata = 1, fact_vars = FALSE)
strat2_Juvenile <- load_data(data = eff3[eff3$maturity == "J",] %>% droplevels(), strata = 2, fact_vars = FALSE)


Zero_Adult <- load_data(data = eff3[eff3$maturity == "A" & eff3$pres == 0,] %>% droplevels(), strata = 1, fact_vars = TRUE)
Zero_Juvenile <- load_data(data = eff3[eff3$maturity == "J" & eff3$pres == 0,] %>% droplevels(), strata = 1, fact_vars = TRUE)



s2_orderd <- list(s2_FA = strat2_Adult$Female,
                  s2_FJ = strat2_Juvenile$Female,
                  s2_MA = strat2_Adult$Female,
                  s2_MJ = strat2_Juvenile$Male)

Zero_ordered <- list(Z_FA = Zero_Adult$Female,
                     Z_FJ = Zero_Juvenile$Female,
                     Z_MA = Zero_Adult$Male,
                     Z_MJ = Zero_Juvenile$Male)
```

```{r figure 3 model list, include=FALSE, eval=FALSE}
## Blacknose

## Blacktip

## Sharpnose
filenames_sn <- list.files("output/output_GAM/best_strat1/sharpnose", pattern="*.rda", full.names=TRUE)

for( i in 1:length( filenames_sn ) ){ load( file = filenames_sn[i] ) }

filenames_sn2 <- list.files("output/output_GAM/best_strat2/sharpnose", pattern="*.rda", full.names=TRUE)

for( i in 1:length( filenames_sn2 ) ){ load( file = filenames_sn2[ i ] ) }

rm( filenames_sn, filenames_sn2 )


### Create list of models

mod_lst_s1 <- list( # Sharpnose
                sn_s1_FA_best = sn_s1_FA_best, ## sn s1
                sn_s1_FJ_best = sn_s1_FJ_best,
                sn_s1_MA_best = sn_s1_MA_best,
                sn_s1_MJ_best = sn_s1_MJ_best)

mod_lst_s2 <- list( # Sharpnose
                sn_s2_FA_best = sn_s2_FA_best, ## sn s2
                sn_s2_FJ_best = sn_s2_FJ_best,
                sn_s2_MA_best = sn_s2_MA_best,
                sn_s2_MJ_best = sn_s2_MJ_best)

sn_mod_lst_s2 <- list( # Sharpnose
                sn_s1_FA_best = sn_s1_FA_best, ## sn s1
                sn_s1_FJ_best = sn_s1_FJ_best,
                sn_s1_MA_best = sn_s1_MA_best,
                sn_s1_MJ_best = sn_s1_MJ_best
                ,
                sn_s2_FA_best = sn_s2_FA_best, ## sn s2
                sn_s2_FJ_best = sn_s2_FJ_best,
                sn_s2_MA_best = sn_s2_MA_best,
                sn_s2_MJ_best = sn_s2_MJ_best)


rm(sn_s1_FA_best, sn_s1_FJ_best, sn_s1_MA_best, sn_s1_MJ_best, 
   sn_s2_FA_best, sn_s2_FJ_best, sn_s2_MA_best, sn_s2_MJ_best)
```

```{r load shape file, include=FALSE, eval=FALSE}
require(maptools)
require(sp)
library(rgdal)
library(lubridate)


gulf.shape <- "shape-file\\Shape\\stateshigh.shp"
gulf.shape <- maptools::readShapePoly(gulf.shape)
```

```{r fig3 prep, include=FALSE, eval=FALSE }
plot_tag <- letters[1:8]


my_xlim <- c(-97.5, -81)

my_ylim <- c(24.5,30.5)

x_ticks <- seq(-98, -81)
#-80.75, -81.25
y_ticks <- round(seq(24.5, 30.5, length.out = 5),1)


cex_pts <- 0.25  #0.425
col_pts <- rgb(0.25,0.25,0.25,0.25) ### only for Strata 1
cex_legend <- 1.25

lwd_axis <- 1
cex_axis <- 1
cex_mtxt <- 1

Lon_line <- 2
Lat_line <- 2.5

## mtxt top
top_ln <- 1.15
top_cex <- 1.25

  # mtxt left
l_ln <- 4    
l_cex <- 1.25
```

#### Figure 3 Sharpnose

```{r Figure 3 Strata 1tiff, include=FALSE, eval=FALSE}
tiff(filename = "6_figures\\figures\\Figure_3_sn.tiff", width = 2000,  height = 2000, res = 300)
```

```{r Figure 3 Strata 1 All plots, include=FALSE, eval=FALSE}

  ## Sharpnose
  
  
par(mfrow = c(4, 2),     # 4x2 layout
    oma = c(2.75, 6, 2.75, 0), # two rows of text at the outer left and bottom margin
    mar = c(0.5, 0.5, 0, 0), # space for one row of text at ticks and to separate plots
    mgp = c(2, 0.75, 0))    # axis label at 2 rows distance, tick labels at 1 row  

layout(matrix(c(1:8), nrow = 4, ncol = 2, byrow = FALSE))

 ### Strata 1
for(i in 1:length(mod_lst_s1)){
  
  vis.gam(mod_lst_s1[[i]],
          view = c("startlon", "startlat"),
          xlim = my_xlim, ylim = my_ylim,
          xlab = "", ylab = "",
          xaxt = "n", yaxt = "n",
          plot.type = "contour", 
          too.far = 0.07, 
          n.grid = 120, 
          main = "",
          bty = "n", 
          cond = list(YEAR = 2013))
  
  sp::plot(gulf.shape, add= T,
         xlim = my_xlim, ylim = my_ylim,
         xlab = "", ylab = "",
         xaxt = "n", yaxt = "n",
         col = "gray",
         bty="n")
  
    par(new = T)
    
    plot(s2_orderd[[i]]$sharpnose$startlon,
         s2_orderd[[i]]$sharpnose$startlat,
       xlim = my_xlim, ylim = my_ylim,
       xlab = "", ylab = "",
       xaxt = "n", yaxt = "n",
       pch = 20,
       bty="n",
       cex = cex_pts)
    
    par(new=T)
    
    plot(Zero_ordered[[i]]$sharpnose$startlon,
         Zero_ordered[[i]]$sharpnose$startlat,
         xlim = my_xlim, ylim = my_ylim,
         xlab = "", ylab = "",
         xaxt = "n", yaxt = "n",
         pch = 21,
         bty="n",
         cex = cex_pts,
         col = col_pts)
    
    ## x-axis
    if(i == 4){
      
    axis(1,
     at = x_ticks,
     lwd = lwd_axis,
     cex.axis = cex_axis)
  
    mtext("Longitude",
      side = 1,
      line = Lon_line,
      cex = cex_mtxt)      
      
    }
    
    ## Y-axis (all plots)
    axis(2,
     at = y_ticks,
     las = 2,
     lwd = lwd_axis,
     cex.axis = cex_axis)
  
    mtext("Latitude",
      side = 2,
      line = Lat_line,
      cex = cex_mtxt)
  
}


### Strata 2
for(i in 1:length(mod_lst_s2)){
  
  vis.gam(mod_lst_s2[[i]],
          view = c("startlon", "startlat"),
          xlim = my_xlim, ylim = my_ylim,
          xlab = "", ylab = "",
          xaxt = "n", yaxt = "n",
          plot.type = "contour", 
          too.far = 0.07, 
          n.grid = 120, 
          main = "",
          bty = "n", 
          cond = list(YEAR = 2013))
  
  sp::plot(gulf.shape, add= T,
         xlim = my_xlim, ylim = my_ylim,
         xlab = "", ylab = "",
         xaxt = "n", yaxt = "n",
         col = "gray",
         bty="n")
  
    par(new = T)
    
    plot(s2_orderd[[i]]$sharpnose$startlon,
         s2_orderd[[i]]$sharpnose$startlat,
       xlim = my_xlim, ylim = my_ylim,
       xlab = "", ylab = "",
       xaxt = "n", yaxt = "n",
       pch = 20,
       bty="n",
       cex = cex_pts)
    
    # x-axis
    if(i == 4){
      
    axis(1,
     at = x_ticks,
     lwd = lwd_axis,
     cex.axis = cex_axis)
  
    mtext("Longitude",
      side = 1,
      line = Lon_line,
      cex = cex_mtxt)      
      
    }
  
}

mtext("Presence",
      side = 3, 
      at = 1/4,
      line = top_ln,
      cex = top_cex,
      outer = TRUE)
        
mtext("Abundance",
      side = 3, 
      at = 0.75,
      line = top_ln,
      cex = top_cex,
      outer = TRUE)
      
mtext("Female Adult",
      side = 2,
      at = 7/8,
      line = l_ln,
      cex = l_cex,
      outer = TRUE)

mtext("Female Juvenile",
      side = 2,
      at = 5/8,
      line = l_ln,
      cex = l_cex,
      outer = TRUE)

mtext("Male Adult",
      side = 2,
      at = 3/8,
      line = l_ln,
      cex = l_cex,
      outer = TRUE)

mtext("Male Juvenile",
      side = 2,
      at = 1/8,
      line = l_ln,
      cex = l_cex,
      outer = TRUE)

dev.off()
```

![**Figure 3 a** Blacknose](figures\Figure_3_(a).tiff)


![**Figure 3 b** Blacktip](figures\Figure_3_(b).tiff)


![**Figure 3 c** Sharpnose](figures\Figure_3_(c).tiff)











































